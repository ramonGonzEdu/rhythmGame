{"version":3,"sources":["rhythm.ts"],"sourcesContent":["import { addDrawer, ctx } from './autoCanvas.js';\nimport { Note } from './noteTypes/index.js';\n\nconst currentNotes: { [key: string]: Note[] } = {};\n\nfunction getAllNotes() {\n\tconst out: Note[] = [];\n\tfor (const key in currentNotes) {\n\t\tout.push(...currentNotes[key]);\n\t}\n\tout.sort((a, b) => a.end - b.end);\n\treturn out;\n}\n\nconst allNotes = getAllNotes();\n\nexport function addNote(note: Note) {\n\tcurrentNotes[note.key] = currentNotes[note.key] ?? [];\n\tcurrentNotes[note.key].push(note);\n\tcurrentNotes[note.key].sort((a, b) => a.end - b.end);\n\n\tallNotes.push(note);\n\tallNotes.sort((a, b) => a.end - b.end);\n}\n\nconst scores: number[] = [];\n\nfunction scoreAvg() {\n\tconst out = scores.reduce((a, b) => a + b, 0) / scores.length;\n\treturn isNaN(out) ? 0 : out;\n}\n\nfunction draw() {\n\tif (allNotes[0]?.isDead()) {\n\t\tconst note = allNotes.shift() as Note;\n\t\tcurrentNotes[note.key].shift();\n\t\tnote.score(ctx, scores, -100);\n\t}\n\n\tfor (const note of allNotes) {\n\t\tif (note.created < Date.now()) {\n\t\t\tnote.draw(ctx);\n\t\t}\n\t}\n\n\t//score text\n\tctx.fillStyle = 'white';\n\tctx.font = '30px Arial';\n\tctx.fillText(\n\t\t'Score: ' + Math.round(scores.reduce((a, b) => a + b, 0)),\n\t\t10,\n\t\t50\n\t);\n\n\tctx.fillText('Avg: ' + Math.round(scoreAvg()), 10, 100);\n}\n\nexport function startGame() {\n\taddDrawer(draw);\n\n\taddEventListener('keydown', (e) => {\n\t\t// console.log(e.key);\n\t\tconst notes = currentNotes[e.key] ?? [];\n\t\tif (notes.length > 0 && notes[0].created < Date.now()) {\n\t\t\tconst note = notes.shift() as Note;\n\t\t\tallNotes.splice(allNotes.indexOf(note), 1);\n\t\t\tnote.score(ctx, scores);\n\t\t}\n\t});\n}\n"],"names":["addDrawer","ctx","currentNotes","getAllNotes","out","key","push","sort","a","b","end","allNotes","addNote","note","scores","scoreAvg","reduce","length","isNaN","draw","isDead","shift","score","created","Date","now","fillStyle","font","fillText","Math","round","startGame","addEventListener","e","notes","splice","indexOf"],"mappings":"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"}